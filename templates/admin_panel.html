<!DOCTYPE html>
<html lang="hu">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Paragliding Sites - Admin Panel</title>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-0Q0L1YYED4"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         
         function gtag() {
           dataLayer.push(arguments);
         }
         gtag("js", new Date());
         
         gtag("config", "G-0Q0L1YYED4");
      </script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/css/tempusdominus-bootstrap-4.min.css" integrity="sha512-3JRrEUwaCkFUBLK1N8HehwQgu8e23jTH4np5NHOmQOobuC4ROQxFwFgBLTnhcnQRMs84muMh0PnnwXlPq5MGjg=="
         crossorigin="anonymous" referrerpolicy="no-referrer" />
      <!-- Include jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <!-- Include Popper.js (required for Bootstrap) -->
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
      <!-- Include Bootstrap JavaScript -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
      <script src="https://kit.fontawesome.com/d3c4500f30.js" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment-with-locales.min.js" integrity="sha512-vFABRuf5oGUaztndx4KoAEUVQnOvAIFs59y4tO0DILGWhQiFnFHiR+ZJfxLDyJlXgeut9Z07Svuvm+1Jv89w5g==" crossorigin="anonymous"
         referrerpolicy="no-referrer"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/js/tempusdominus-bootstrap-4.min.js" integrity="sha512-k6/Bkb8Fxf/c1Tkyl39yJwcOZ1P4cRrJu77p83zJjN2Z55prbFHxPs9vN7q3l3+tSMGPDdoH51AEU8Vgo1cgAA=="
         crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js" integrity="sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script type="text/javascript">
         $(function() {
           bootbox.setLocale("Us"); /*$(document).tooltip();*/
         });
      </script>
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
      <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
   <!-- Hotjar Tracking Code for LLSC Paraglide -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3698358,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
   </head>
   <div class="container-xl main">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top p-0">
         <a class="navbar-brand bg-primary px-4 py-3" href="{{ url_for('index') }}">
         L L S C
         </a>
         <button class="navbar-toggler px-4 py-3 border-0" type="button"
            data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
            >+</button>
         <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav border-top border-lg-0">
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('index') }}">Home </a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('sites') }}">Local Sites</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('links') }}">Links</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('quiz') }}">Quiz</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('about') }}">About</a>
               </li>
            </ul>
            <ul class="navbar-nav ms-auto me-0 me-lg-3 border-top border-lg-0">
               {% if 'username' not in session %}
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('login') }}">Login</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('register') }}">Register</a>
               </li>
               {% endif %}
               {% if 'admin' in session and session['admin'] == 'yes' %}
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3 active" aria-current="page" href="{{ url_for('admin_panel') }}">Admin Panel</a>
               </li>
               {% endif %}
               {% if 'username' in session %}
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('myaccount') }}">My Account</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link px-4 px-lg-2 py-3" href="{{ url_for('logout') }}">Logout</a>
               </li>
               {% endif %}
            </ul>
         </div>
      </nav>
   </div>
   </div>
   <body class="content">
      {% if 'admin' in session and session['admin'] == 'yes' %}
      <div class="admin-panel-content">
         <h1>Welcome, Admin!</h1>
         <div class="container mt-5">
            <ul class="nav nav-tabs" id="myTabs" role="tablist">
               <li class="nav-item" role="presentation">
                  <a class="nav-link active" id="news-tab" data-bs-toggle="tab" href="#news" role="tab" aria-controls="news" aria-selected="true">News</a>
               </li>
               <li class="nav-item" role="presentation">
                  <a class="nav-link" id="users-tab" data-bs-toggle="tab" href="#users" role="tab" aria-controls="users" aria-selected="false">Users</a>
               </li>
               <li class="nav-item" role="presentation">
                  <a class="nav-link" id="sites-tab" data-bs-toggle="tab" href="#sites" role="tab" aria-controls="sites" aria-selected="false">Sites</a>
               </li>
            </ul>
            <div class="tab-content mt-3" id="myTabContent">
               <div class="tab-pane fade show active" id="news" role="tabpanel" aria-labelledby="news-tab">
                  <div class="container mt-5">
                     <h3>Add News</h3>
                     <form method="POST" action="/add_news">
                        <div class="form-group">
                           <label for="date">Date:</label>
                           <input type="date" class="form-control" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                           <label for="title">Title:</label>
                           <input type="text" class="form-control" id="title" name="title" placeholder="Enter news title" required>
                        </div>
                        <div class="form-group">
                           <label for="text">Text:</label> 
                           <textarea class="form-control" id="text" name="text" placeholder="Enter news text" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add News</button>
                     </form>
                  </div>
                  <div class="container mt-5">
                     <h3>List of News</h3>
                     <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Title</th>
                                <th>Text</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for news_item in news %}
                            <tr>
                                <td>{{ news_item[1] }}</td>
                                <td>{{ news_item[2] }}</td>
                                <td>{{ news_item[3] }}</td>
                                <td>
                                 <form id="delete-news-form-{{ news_item[0] }}" method="post" action="/delete_news">
                                    <input type="hidden" name="id" value="{{ news_item[0] }}">
                                    <button class="btn btn-danger" type="button" onclick="confirmDeleteNews('{{ news_item[0] }}')">Delete News</button>
                                 </form>                                
                             </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                  </div>
               </div>
               <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                  <div class="container mt-5">
                     <div class="container mt-5">
                        <h3>Add New User</h3>
                        <form method="POST" action="{{ url_for('add_user') }}" class="row g-3">
                            <div class="col-md-4">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" placeholder="Enter username" required>
                            </div>
                            <div class="col-md-4">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" placeholder="Enter password" required>
                            </div>
                            <div class="col-md-4">
                                <label for="confirm_password" class="form-label">Repeat Password</label>
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Repeat password" required>
                            </div>
                            <div class="col-md-4">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="Enter email" required>
                            </div>
                            <div class="col-md-4">
                                <label for="license_type" class="form-label">License Type</label>
                                <select class="form-control" id="license_type" name="license_type" required>
                                    <option value="EP - Elementary Pilot">EP - Elementary Pilot</option>
                                    <option value="CP - Club Pilot">CP - Club Pilot</option>
                                    <option value="Pilot">Pilot</option>
                                </select>
                            </div>
                            <div class="col-md-12 mt-3">
                                <button type="submit" class="btn btn-primary">Add User</button>
                            </div>
                        </form>
                    </div>
                    <br>
                     <h3>Registered Users</h3>
                     <table class="table table-bordered">
                        <thead>
                           <tr>
                              <th>ID</th>
                              <th>Username</th>
                              <th>Email</th>
                              <th>Action</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for user in users %}
                           <tr>
                               <td>{{ user[0] }}</td>
                               <td>{{ user[1] }}</td>
                               <td>{{ user[3] }}</td>
                               <td>
                                   <form id="delete-user-form-{{ user[0] }}" method="post" action="/delete_user">
                                       <input type="hidden" name="user_id" value="{{ user[0] }}">
                                       <input type="hidden" name="delete_permission" value="{{ user[5] }}">
                                       {% if user[5] == "no" %}
                                           <button class="btn btn-danger" type="button" onclick="confirmDeleteUser('{{ user[0] }}')">Delete User</button>
                                       {% elif user[5] == "yes" %}
                                           <button class="btn btn-warning" type="button" disabled>Protected user</button>
                                       {% endif %}
                                   </form>
                               </td>
                           </tr>
                       {% endfor %}                       
                        </tbody>
                     </table>
                  </div>
               </div>
               <div class="tab-pane fade" id="sites" role="tabpanel" aria-labelledby="sites-tab">
                  <div class="container mt-5">
                     <h3>Feature not introduced yet. Check back in later.</h3>
                  </div>
               </div>
            </div>
         </div>
      </div>
      {% endif %}
      <div class="flash-messages-container">
         {% with messages = get_flashed_messages(with_categories=true) %}
         {% if messages %}
         {% for category, message in messages %}
         <div class="alert alert-{{ category }} d-flex flex-column justify-content-center align-items-center">
            {{ message }}
         </div>
         {% endfor %}
         {% endif %}
         {% endwith %}
      </div>
      <script src="{{ url_for('static', filename='script.js') }}"></script>
      <script>
         function confirmDeleteNews(newsId) {
             bootbox.confirm({
                 message: "Are you sure you want to delete this news?",
                 buttons: {
                     confirm: {
                         label: 'Yes',
                         className: 'btn-danger'
                     },
                     cancel: {
                         label: 'No',
                         className: 'btn-secondary'
                     }
                 },
                 callback: function (result) {
                     if (result) {
                         document.getElementById('delete-news-form-' + newsId).submit();
                     }
                 },
                 onEscape: true
             });
         }
 
         function confirmDeleteUser(userId) {
             bootbox.confirm({
                 message: "Are you sure you want to delete this user?",
                 buttons: {
                     confirm: {
                         label: 'Yes',
                         className: 'btn-danger'
                     },
                     cancel: {
                         label: 'No',
                         className: 'btn-secondary'
                     }
                 },
                 callback: function (result) {
                     if (result) {
                         document.getElementById('delete-user-form-' + userId).submit();
                     }
                 },
                 onEscape: true
             });
         }
     </script>
   </body>
</html>